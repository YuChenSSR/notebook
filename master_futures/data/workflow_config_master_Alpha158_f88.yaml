qlib_init:
  provider_uri: "/home/idc2/notebook/futures/data/qlib_bin/cn_data_train"
  region: cn

# 只跑主力连续（*88），依赖 qlib_bin/instruments/f88.txt 已生成
market: &market f88

# 期货训练暂不依赖 benchmark（训练入口会兼容缺失）；保留字段便于后续扩展
benchmark: &benchmark null

data_handler_config: &data_handler_config
  start_time: 2010-01-04
  end_time: 2025-12-12
  fit_start_time: 2010-01-04
  fit_end_time: 2024-06-30
  instruments: *market
  infer_processors:
    - class: RobustZScoreNorm
      kwargs:
        fields_group: feature
        clip_outlier: true
    - class: Fillna
      kwargs:
        fields_group: feature
  learn_processors:
    - class: DropnaLabel
      kwargs:
        fields_group: label
  label: ["Ref($adjclose, -5) / Ref($adjclose, -1) - 1"]

task:
  model:
    class: MASTERModel
    module_path: master_futures.code.Master.master
    kwargs:
      seed: 0
      seed_num: 5

      # FuturesAlpha158 base_features=163（见 handler_futures_alpha158.py），额外追加 gate_features=8
      d_feat: 162
      gate_input_start_index: 162
      gate_input_end_index: 163

      d_model: 256
      t_nhead: 4
      s_nhead: 2
      dropout: 0.2

      n_epochs: 20
      lr: 0.00001
      train_stop_loss_thred: 0.2
      GPU: 0
      beta: 2

      market: *market
      benchmark: *benchmark
      save_prefix: *market

  dataset:
    class: TSDatasetH
    module_path: qlib.data.dataset
    kwargs:
      handler:
        class: FuturesAlpha158WithGate
        module_path: master_futures.code.handler_futures_alpha158
        kwargs: *data_handler_config
      segments:
        train: [2010-01-04, 2024-06-30]
        valid: [2024-07-01, 2024-12-31]
        test: [2025-01-01, 2025-12-12]
      step_len: 8

